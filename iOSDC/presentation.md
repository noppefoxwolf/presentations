footer: ğŸ¦Š @noppefoxwolf, 2018
slidenumbers: true

> ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªã®ã‚¢ã‚¤ãƒ†ãƒ å†ç”Ÿã‚’Metalã§å®Ÿè£…ã™ã‚‹äº‹ã«ãªã£ãŸè©±
-- iOSDC Japan Track B 2018/09/02 11:20ã€œ

^ ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚
^ ã€Œãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªã®ã‚¢ã‚¤ãƒ†ãƒ å†ç”Ÿã‚’ã€Metalã§å®Ÿè£…ã™ã‚‹äº‹ã«ãªã£ãŸè©±ã€‚ã€ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§ç™ºè¡¨ã—ã¾ã™ã€‚
^ æœ¬ãƒˆãƒ¼ã‚¯ã¯ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å…ƒã«å‹•ç”»åƒã®ç·¨é›†ãƒ»è¡¨ç¤ºã®é ˜åŸŸã«é–¢ã—ã¦èˆˆå‘³ã‚’æŒã£ã¦ã„ãŸã ãã“ã¨
^ ã¾ãŸã€GPUã‚’æ“ä½œã™ã‚‹OpenGLESã‚„Metalãªã©ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å®Ÿè£…ã®é¸æŠè‚¢ã¨ã—ã¦æŒã£ã¦ã„ãŸã ãã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
^ ãƒ©ã‚¤ãƒ–é…ä¿¡æŠ€è¡“è‡ªä½“ã«é–¢ã™ã‚‹ç‚¹ã«ã¤ã„ã¦ã¯ã€æœ¬ãƒˆãƒ¼ã‚¯ã§ã¯æ‰±ã„ã¾ã›ã‚“ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚

---

#[fit] noppe

ğŸ¢ æ ªå¼ä¼šç¤¾ãƒ‡ã‚£ãƒ¼ãƒ»ã‚¨ãƒŒãƒ»ã‚¨ãƒ¼
ğŸ¦Š ãã¤ã­å¥½ã
ğŸ’» ï¼’ï¼ï¼‘ï¼ã€œ

![right](IMG_0726.PNG)

^ ã¾ãšã€è‡ªå·±ç´¹ä»‹ã‚’ã•ã›ã¦ãã ã•ã„ã€‚
^ æ ªå¼ä¼šç¤¾ãƒ‡ã‚£ãƒ¼ãƒ»ã‚¨ãƒŒãƒ»ã‚¨ãƒ¼ã§iOSã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹noppeã¨è¨€ã„ã¾ã™ã€‚
^ å‹•ç‰©ã®ç‹ãŒå¥½ãã§ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚‚ç‹ã§ã™ã€‚ãã¤ã­ã®ã‚·ãƒ£ãƒ„ç€ã¦ã„ã‚‹ã®ãŒã„ãŸã‚‰è©±ã—ã‹ã‘ã¦ãã ã•ã„ã€‚
^ ã‚¢ãƒ—ãƒªé–‹ç™ºã¯ç‹¬å­¦ã§2010å¹´ã”ã‚ã‹ã‚‰ç¶šã‘ã¦ã„ã¦ã€ä»Šå¹´ã§ï¼˜å¹´ç›®ã§ã™ã€‚
^ ã“ã‚Œã¾ã§å€‹äººã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã€ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒãƒ™ãƒ«ã‚²ãƒ¼ãƒ ã‚„Twitterã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’AppStoreã§ãƒªãƒªãƒ¼ã‚¹ã—ã¦ãã¾ã—ãŸã€‚
^ OpenGLã‚„Metalãªã©ã®GPUå‘¨ã‚Šã¯ä»Šå¹´ã«å…¥ã£ã¦ã‹ã‚‰è§¦ã‚Šå§‹ã‚ã¾ã—ãŸã€‚
^ æ—¢ã«//TODO
^ ä»Šå›ã¯ã€ã“ã‚Œã‚‰ã®GPUå‘¨ã‚Šã®å­¦ç¿’ã«ç½®ã„ã¦æ‰‹é ƒãªäº‹ä¾‹ã‚’ç”¨æ„å‡ºæ¥ãŸã¨æ€ã†ã®ã§è§¦ã£ãŸã“ã¨ã®ç„¡ã„æ–¹ã‚‚//TODO

---

ä»Šæ—¥ã®è©±
ãƒ»Pocochaã®ç´¹ä»‹
ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å†ç”Ÿæ‰‹æ³•
ãƒ»UIKit/OpenGLES/Metalã§ã®æç”»
ãƒ»ã¾ã¨ã‚
    ãƒ»æœ¬å½“ã«Metalã§å®Ÿè£…ã—ãªã„ã¨ã„ã‘ãªã„ã®ã‹
    ãƒ»Metalã®ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

^ ã•ã¦ã€ä»Šæ—¥ãŠè©±ã™ã‚‹å†…å®¹ã«ã¤ã„ã¦ã§ã™ãŒã€æœ€åˆã«å¼Šç¤¾ã§ãƒªãƒªãƒ¼ã‚¹ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªã®Pocochaã®ç´¹ä»‹ã‚’ã—ã¾ã™ã€‚
^ ãã®ã‚ã¨ã§ã€ã‚¢ãƒ—ãƒªã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå†ç”Ÿæ‰‹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚
^ æ¬¡ã«ã€ãã‚Œã‚‰ã®å†ç”Ÿæ‰‹æ³•ã‚’UIKitã€OpenGLESã€Metalã§ãã‚Œãã‚Œå®Ÿè£…ã—ãŸçµæœã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚
^ æœ€å¾Œã«ä»Šæ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¾ã¨ã‚ã‚’ã—ã¾ã™ã€‚
^ ãªãŠä»Šå›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯ã€è§£èª¬ã®é–¢ä¿‚ä¸Šå®Ÿéš›ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã¨ä»•æ§˜ãŒç•°ãªã‚‹ç®‡æ‰€ãŒã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚
^ æœ¬æ—¥ã¯30åˆ†ç¨‹åº¦ã«ãªã‚Šã¾ã™ãŒã€ãœã²æœ€å¾Œã¾ã§ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

---

#[fit] ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªPocochaï¼ˆãƒã‚³ã¡ã‚ƒï¼‰ã®ç´¹ä»‹

^ ãã‚Œã§ã¯æœ€åˆã«å¼Šç¤¾ã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªPocochaã‚’ç´¹ä»‹ã•ã›ã¦ãã ã•ã„ã€‚

---

//Pocochaã®ç”»åƒã€ã§ãã‚Œã°å³å´ã«å‹•ç”»ã§ãŠã„ã¦ã‚‚ã„ã„ã‹ã‚‚

^ Pocochaã¯ã€2017å¹´åˆé ­ã«ãƒªãƒªãƒ¼ã‚¹ã—ãŸãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªã§ã™ã€‚
^ ã©ã“ã§ã‚‚æ‰‹è»½ã«ã‚¹ãƒãƒ›ã§ç¸¦å‹ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒã§ãã€è¦–è´è€…ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½¿ã£ã¦é…ä¿¡æ ã‚’ç››ã‚Šä¸Šã’ãŸã‚Šã¨ã„ã£ãŸã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ¥½ã—ã‚ã¾ã™ã€‚
^ ã¾ãŸé«˜æ©Ÿèƒ½ãªç¾é¡”ãƒ»ç¾è‚Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ­è¼‰ã—ã¦ã„ã¦ã€é…ä¿¡//TODO
^ ä»Šæ—¥ã¯ãã‚“ãªæ©Ÿèƒ½ã®ä¸­ã§ã‚‚ã€ã‚¢ã‚¤ãƒ†ãƒ ãŒã©ã®ã‚ˆã†ãªæŠ€è¡“ã§å†ç”Ÿã•ã‚Œã¦ã„ã‚‹ã®ã‹ã®è©±ã‚’ã—ã¾ã™ã€‚

---

# ã‚¢ã‚¤ãƒ†ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å†ç”Ÿæ‰‹æ³•

^ ã‚¢ã‚¤ãƒ†ãƒ ã®è©±ã‚’ã™ã‚‹å‰ã«ã€Pocochaã®ã‚¢ã‚¤ãƒ†ãƒ ãŒã©ã®ã‚ˆã†ãªã‚®ãƒŸãƒƒã‚¯ãªã®ã‹ã‚’è¦‹ã¦è¦‹ã¾ã—ã‚‡ã†ã€‚

---

// ã‚¢ã‚¤ãƒ†ãƒ ãŒå®Ÿéš›ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã§ç™ºå‹•ã™ã‚‹æ§˜å­ã®å‹•ç”»

^ ã‚¢ã‚¤ãƒ†ãƒ ã¯ã€æœ‰æ–™ã§è³¼å…¥ã™ã‚‹äº‹ãŒã§ãåˆ©ç”¨ã™ã‚‹ã¨é…ä¿¡è€…ãƒ»è¦–è´è€…ã®ä¸¡æ–¹ã®ç”»é¢ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†ç”Ÿã•ã‚Œã¾ã™ã€‚
^ æ˜¨ä»Šã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªã§ã¯ã€ã“ã®ã‚ˆã†ãªã‚¢ã‚¤ãƒ†ãƒ ã®æ¦‚å¿µãŒå¿…ãšã¨è¨€ã£ã¦ã„ã„ã»ã©å°å…¥ã•ã‚Œã¦ãŠã‚Šã‚¢ã‚¤ãƒ†ãƒ ã®è¡¨ç¾åŠ›ã‚‚ã‚µãƒ¼ãƒ“ã‚¹å·®åˆ¥åŒ–ã®ä¸Šã§é‡è¦ã«ãªã£ã¦ãã¾ã™ã€‚
^ Pocochaã§ã¯ã€å¤šãã®ã‚¢ã‚¤ãƒ†ãƒ ã§ç”»é¢å…¨ä½“ã‚’è¦†ã†æ´¾æ‰‹ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å›³è§£
750â€†Ã—â€†1334 60fps rgba nosound
^ å…ˆã»ã©ã®ãƒ‡ãƒ¢ã§ã¯ã©ã†ã„ã£ãŸä»•æ§˜ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†ç”Ÿã•ã‚Œã¦ã„ã‚‹ã‹ã¨ã„ã†ã¨
^ 750x1334ã®é€éæƒ…å ±ã‚’æŒã£ãŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã™ã€‚
^ ã¾ãŸã€Pocochaã¯å½“æ™‚iOS9ã®OSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãŸãŸã‚iPhone5cã‚„ç¬¬ä¸‰ä¸–ä»£ã®iPadãªã©ã§ã‚‚åˆ©ç”¨ã§ãã¾ã—ãŸã€‚

---

// å†ç”Ÿã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã®æµã‚Œ
// ã‚¢ã‚¦ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°
// ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
^ ã‚¢ã‚¤ãƒ†ãƒ ã¯ã€movãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã‹ã‚‰æ¸¡ã•ã‚Œã¾ã™ã€‚

---

â‘  AVPlayerã§å†ç”Ÿã™ã‚‹

```swift
let url = Bundle.main.url(forResource: "item_effect",
                          withExtension: "mov")!
let asset = AVURLAsset(url: url)
let item = AVPlayerItem(asset: asset)
let player = AVPlayer(playerItem: item)
let playerLayer = AVPlayerLayer(player: player)
playerLayer.backgroundColor = UIColor.clear.cgColor

view.layer.addSubLayer(playerLayer)
player.play()
```

---

â‘  AVPlayerã§å†ç”Ÿã™ã‚‹

[.code-highlight: 1-2]

```swift
let url = Bundle.main.url(forResource: "item_effect",
                          withExtension: "mov")!
let asset = AVURLAsset(url: url)
let item = AVPlayerItem(asset: asset)
let player = AVPlayer(playerItem: item)
let playerLayer = AVPlayerLayer(player: player)
playerLayer.backgroundColor = UIColor.clear.cgColor

view.layer.addSubLayer(playerLayer)
player.play()
```

^ AVPlayerã¯MOVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã§ã€ãã®ã¾ã¾å‘¼ã³å‡ºã—ã¾ã™ã€‚

---

â‘  AVPlayerã§å†ç”Ÿã™ã‚‹

[.code-highlight: 7]

```swift
let url = Bundle.main.url(forResource: "item_effect",
                          withExtension: "mov")!
let asset = AVURLAsset(url: url)
let item = AVPlayerItem(asset: asset)
let player = AVPlayer(playerItem: item)
let playerLayer = AVPlayerLayer(player: player)
playerLayer.backgroundColor = UIColor.clear.cgColor

view.layer.addSubLayer(playerLayer)
player.play()
```

^ é€éæƒ…å ±ã‚’æŒã¤movãªã®ã§ã€èƒŒæ™¯è‰²ã‚’é€éã—ã¾ã™ã€‚çµæœã¯

---



---

UIImageView.animate
//è©³ç´°

---

`ffmpeg -i M_sea30fps.mov M_sea30fps/output_%04d.png`
du -h
288M    ./M_sea60fps

---

å®Ÿè¡Œ
é–‹å§‹å‘½ä»¤ã‹ã‚‰é–‹å§‹ã¾ã§éå¸¸ã«é…ã„
ãƒ¡ãƒ¢ãƒª1GBç¨‹åº¦å æœ‰ã€ã“ã‚Œãªã‚“ã§ã 
^ æ¥µç«¯ãªã“ã¨ã‚’ã™ã‚‹ã®ã¯ç„¡é§„ã§ã¯ãªã„ã€å‹‰å¼·ã«ãªã£ãŸ
^ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ„è­˜ã™ã‚‹ä¸Šã§æ°—ã«ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹

---

äºŒã¤ã®å•é¡Œ
ãƒ»å®¹é‡
ãƒ»å†ç”Ÿãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

^ ãƒ¡ãƒ¢ãƒªã‚’åœ§è¿«ã™ã‚‹ã“ã¨ã§CPUã‚„ãƒãƒƒãƒ†ãƒªãƒ¼ã«å½±éŸ¿ãŒ
^ é…ä¿¡ã‚‚ã—ã¦ã„ã‚‹ã®ã§ãã‚“ãªã«ä½™è£•ã¯ãªã„

---

ãƒ»8fpsãã‚‰ã„ã«è½ã¨ã—ã¦é‹ç”¨

^ åŠå¹´ãã‚‰ã„
^ æœ€åˆã¯ãã‚“ãªã«æ´¾æ‰‹ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§ã¯ãªã‹ã£ãŸã®ã§å¤§ä¸ˆå¤«ã ã£ãŸã€‚
^ åŠå¹´å¾Œã«ã‚¢ã‚¤ãƒ†ãƒ ã®è¡¨ç¾ã‚’ãƒªãƒƒãƒã«ã™ã‚‹ã“ã¨ã«ãªã£ãŸ

---

ã¾ãšã¯å®¹é‡
movãƒ•ã‚¡ã‚¤ãƒ«ï¼š493MB
é€£ç•ªPNG:302MB

^å®¹é‡ãŒå¤šã„ã¨ãªãœå›°ã‚‹ã‹
^ã‚¢ãƒ—ãƒªã®èµ·å‹•ä¸­ã«å–ã£ã¦ãã‚‹

---

åœ§ç¸®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
ãã“ã§å®ˆã‚‰ãªã„ã¨ã„ã‘ãªã„ç‚¹
ãƒ»é€éæƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹
ãƒ»fpsã‚’è½ã¨ã•ãªã„
ãƒ»ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ãªã„

^ é€éã¯ã—ãªã„ã¨çœŸã£æš—ã«ãªã‚‹
^ ä¸‹äºŒã¤ã¯ã‚¯ã‚ªãƒªãƒ†ã‚£ã®åŠ£åŒ–ã«ç›´æ¥é€šã˜ã‚‹ã‹ã‚‰

---

ä¸€ã¤ã¯å‹•ç”»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ä¸€ã¤ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

---

MOV
Webm VP8 with alpha
https://www.reddit.com/r/explainlikeimfive/comments/2p4a6c/eli5_the_difference_between_html5_video_webm_and/
GIF
APNG
WEBP

æ®‹å¿µãªãŒã‚‰mp4ã¯é€éã«å¯¾å¿œã—ã¦ã„ãªã„

---

- WEBM
https://github.com/brion/OGVKit

é€éå¯¾å¿œã—ã¦ãªã‹ã£ãŸã‚Šã™ã‚‹ã€ã‚ã¨ä¸å®‰å®š
ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ‡ã‚³ãƒ¼ãƒ€ã¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ã‚³ãƒ¼ãƒ‰ã®è¦³ç‚¹
h265ã®åœ§ç¸®åŠ¹ç‡

---

- PNG/JPG
ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ

---

- GIF
https://github.com/kirualex/SwiftyGif
GIFã‚’1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«UIImageã«å¤‰æ›ã—ã¦ã€ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§UIImageView.imageã‚’å·®ã—æ›¿ãˆã¦ã„ã‚‹
ä¸€èˆ¬çš„ãªéå¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å¯¾å¿œã®ä»•æ–¹
æ™®é€šã¯UIImageViewã‚’ä½¿ã†ã®ã§ä½¿ã„å‹æ‰‹ãŒè‰¯ã„

---

- APNG
https://github.com/onevcat/APNGKit
libpng
APNGImageView: UIView
ä¸€åº¦UIImageã«å¤‰æ›ã—ã¦ã‹ã‚‰CGImageã‚’layer.contentsã«è¨­å®š
ã“ã‚Œã¯UIImageViewã¨åŒã˜ä»•çµ„ã¿

---

- WEBP
libWEBP

---

- MP4
h264
é€éæƒ…å ±æŒã¦ãªã„
ãƒ‡ãƒ•ã‚©ã§å¯¾å¿œ

---

- MOV
é€éæƒ…å ±ãŒæŒã¦ã‚‹

---

è¡¨
|iOSã§å†ç”Ÿã§ãã‚‹ã‹|åœ§ç¸®ç‡|é€é|

^è¨ˆæ¸¬
^ãªã‹ãªã‹è‰¯ã•ã’ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒãªã„

---

æ˜”ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãŸæ™‚
é€éPNGãŒä½¿ãˆãªã‹ã£ãŸå½“æ™‚ã€jpgã§alpha maskã—ã¦é€éã—ã¦ã„ãŸã€‚
ã“ã®æ‰‹æ³•ã¯ä»Šå›ä½¿ãˆãã†ã€‚

---

éé€éã®ãƒ“ãƒ‡ã‚ªAãƒ»éé€éã®ãƒ“ãƒ‡ã‚ªB
æ¯ãƒ•ãƒ¬ãƒ¼ãƒ é€éåˆæˆã—ã¦ã„ãã€ãã‚Œã‚’æç”»
^ å®¹é‡æ¯”è¼ƒ

---

// ======================================================

---

UIKit/GLKit/MetalKitã®æç”»

^ å…ˆã»ã©ã®æ¯ãƒ•ãƒ¬ãƒ¼ãƒ åˆæˆã—ãŸé€éç”»åƒã‚’è¡¨ç¤ºã—ãŸã„ã€‚
^ ã“ã“ã§ã¯ã€ã©ã†ã‚„ã£ã¦ã€ä½•ã«è¡¨ç¤ºã™ã‚‹ã®ã‹ã®è©±

---

é€éã®æ–¹æ³•

ãƒ»CIFilterã‚’åˆ©ç”¨ã™ã‚‹

^CIFilterã®èª¬æ˜
^ãƒ•ã‚£ãƒ«ã‚¿ãŒã„ãã¤ã‹ã‚ã‚‹
^è‡ªåˆ†ã§æ›¸ãã“ã¨ã‚‚ã§ãã‚‹
^å†…éƒ¨çš„ã«Metal/OpenGLESã‚’åˆ‡ã‚Šæ›¿ãˆã¦ãã‚Œã‚‹

---

è¡¨ç¤ºã®æ–¹æ³•
ãƒ»UIImageViewã«è¡¨ç¤ºã™ã‚‹

---

ã“ã‚Œã§å®Ÿè£…ã—ã¦è¦‹ãŸ
[å‹•ç”»]

---

ã“ã®å¾Œã®æµã‚Œ
å†ç”Ÿã§ãã¦ãªã„
fpsãŒå–ã‚Œãªã„ã¨æ€ã†

---

ã©ã“ãŒé…ã„ã®ã‹
CIFilterã®ç”Ÿæˆ

---

CIFilterã®outputãŒé…ã„ã¨ã„ã†ã“ã¨ã¯ã€CGImageãŒã©ã“ã‹ã§ä½œã‚‰ã‚Œã¦ã„ã‚‹ï¼Ÿï¼ˆãƒ‡ãƒ¢ã¨ã—ã¦CGImageä½œã£ã¦é©ç”¨ã§ã‚‚ã„ã„ã‹ã‚‚ï¼‰
OpenGLä½¿ã£ã¦ã¿ãŸ
^ ç†ç”±ã¯ï¼Ÿ
^ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ä¸Šã§åˆæˆã‚’è¡Œãˆã°ã€ãã®çµæœã‚’è¡¨ç¤ºã™ã‚Œã°ã„ã„ã ã‘ãªã®ã§åŠ¹ç‡çš„ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã£ãŸ.
^ CIFilterã¯é€£ç¶šã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹ã¨ãã«è¾›ã„ï¼Ÿ
^ ãã‚‚ãã‚‚ãƒ“ãƒ‡ã‚ªã®pixelBufferã‚’CIImageã«å…¥ã‚Œã¦å‡¦ç†ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§CGImageã¸ã®å¤‰æ›ãŒèµ°ã£ã¦ã„ã‚‹ã‹ã‚‚
^ CIFilteré…ã„ã£ã¦è¨€ã‚ã‚Œã¦ã„ãŸï¼ˆ2013ã”ã‚
^ ã“ã®æ™‚ç‚¹ã§Metalã®é¸æŠè‚¢ã‚‚ã‚ã£ãŸãŒã€iPhone5cã‚„iPad 3rdã‚’ã‚¢ãƒ—ãƒªãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãŸ
^ CPU GPUé–“ã®è»¢é€ã¯éå¸¸ã«ã‚³ã‚¹ãƒˆãŒå¤§ãã„ã€‚
^ wwdcã§åŠ¹ç‡çš„ãªäº‹è¨€ã£ã¦ãŸã‘ã©iOS10ã ã¨ã¾ã æœ€é©åŒ–ã•ã‚Œã¦ãªã„ã®ã‹ã‚‚

---

ã¨ã‚Šã‚ãˆãšå®Ÿéš›ã«å®Ÿè£…ã—ã¦ã¿ãŸ
OpenGLESã¯UIKitã§ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¯é¦´æŸ“ã¿ãŒãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚
åƒ•ã‚‚ãªã‹ã£ãŸã€‚åˆã‚ã¦è§¦ã‚‹ã€æ—©ã„å°è±¡ã€‚é«˜ã„äº’æ›æ€§
ãã—ã¦ã€ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰ãŒé›£ã—ã„ã€‚
GPUImageã§ã‚‚åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚
æ˜”ã‹ã‚‰ã‚ã‚‹ã€
OpenGLESã¯ç°¡å˜ã«è¨€ãˆã°ã€æ¸¡ã•ã‚ŒãŸç”»åƒã‚’ã©ã®ã‚ˆã†ã«è¡¨ç¤ºã™ã‚‹ã‹ï¼†è¡¨ç¤ºã‚’æ‹…ã†ã€‚
ã“ã‚Œã¯CIFilterã¨UIImageViewã®ä¸¡æ–¹

GLKitã‚’åˆ©ç”¨ã™ã‚‹ã¨ç°¡å˜ã«ä½œã‚Œã‚‹
GLKViewã‚„GLKViewController
OpenGLESã§

é€éã™ã‚‹éš›ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã‚³ãƒ¼ãƒ‰

å®Ÿéš›ã«å®Ÿè£…ã—ã¦è¡¨ç¤ºã—ã¦ã¿ã¾ã—ãŸã€‚
æ—©ã„ï¼Ÿé…ã„ï¼Ÿ

Instrumentsã§ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
GPU DriverãŒã„ã„ã€‚
Xcode7ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã€‚

---

OpenGLESãŒdeplicatedã«ãªã£ãŸã®ã§Metalä½¿ã£ã¦è¡Œãã¾ã—ã‚‡ã†
toolsetã§ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æ›¸ã‘ã‚‹
OpenGLESãŒãªã‚“ã¨ãªãåˆ†ã‹ã‚Œã°ã€Metalã¯ã‚‚ã£ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã€‚
ãªãœãªã‚‰ã€Metalã¯ãƒªãƒƒãƒãªinterfaceã ã‹ã‚‰

---

Metalã‚’ä½¿ã†ä¸Šã§ã¾ã è¾›ã„ã¨ã“ã‚
iOS9/10ãªã©ã®Metaléå¯¾å¿œæ©Ÿç¨®ã‚’å«ã‚€OSã§ã¯OpenGLESã¨ä¸€ç·’ã«å®Ÿè£…ãŒå¿…è¦
â†’ãƒ‡ãƒãƒƒã‚°å·¥æ•°ãŒå¢—ãˆã‚‹
ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ“ãƒ«ãƒ‰ãŒã§ããªã„

ã„ã„ã¨ã“ã‚
OpenGLESã‚ˆã‚Šã‚‚åŠ¹ç‡çš„ã«GPUã¸ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã§ãã‚‹
é«˜æ©Ÿèƒ½ãªãƒ‡ãƒãƒƒã‚¬ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹
ã‚·ã‚§ãƒ¼ãƒ€ã‚’æ›¸ãã¨ãã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒèµ°ã‚‹
åœ§å€’çš„ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼ˆã‚‚ã¯ã‚„ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã¯ãªã„ï¼‰

---

çµå±€Metalã§å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ã‚ã‚‹ã®ï¼Ÿ

```
UIImage(ciimage:)
```
ä½¿ãˆã°ä¸è¦ã‹ã‚‚

é©åˆ‡ã«UIImageã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ä¸è¦ã«ãªã‚‹
CIFilterã§ååˆ†ã‹ã‚‚ã—ã‚Œãªã„ã€‚
CIFilterã¯æ—©ã„ã
ã§ã‚‚ã•ã€Metalã‚’çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ã§ã€æ›¸ãã“ã¨ã§
ä½ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ã†ã“ã¨ã®åˆ©ç‚¹
Metalã¯æ©Ÿæ¢°å­¦ç¿’ã§ä½¿ãˆã‚‹ã‹ã‚‚

---

----------------------------------

# ã‚µãƒ¼ãƒ“ã‚¹ã®ç´¹ä»‹

ãƒ©ã‚¤ãƒ–é…ä¿¡çŸ¥ã£ã¦ã¾ã™ã‹
ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã®æœ€è¿‘ã®å‹•å‘
é…ä¿¡ã™ã‚‹ã ã‘ã§ã¯ãªãã€ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½¿ã£ã¦é…ä¿¡ã‚’ç››ã‚Šä¸Šã’ã‚‹æµã‚Œã«
ã‚¢ã‚¤ãƒ†ãƒ ã®æ´¾æ‰‹ã•ã‚„æ¥½ã—ã•ãŒå·®åˆ¥è¦ç´ ã«
DeNAã§è‡ªåˆ†ã¯Pocochaã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚„ã£ã¦ã„ã‚‹
ã‚¢ã‚¤ãƒ†ãƒ ã¨ã¯ã©ã‚“ãªã‚‚ã®ãªã®ã‹

---

å…·ä½“çš„ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ã‚‚ã‚‰ã†ãŸã‚ã«å‹•ç”»
Pocochaã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¦‹ã¦æ¬²ã—ã„
[å‹•ç”»]
ã“ã‚Œã‚’ã©ã®ã‚ˆã†ã«å®Ÿè£…ã—ãŸã‹ã‚’é †ã‚’è¿½ã£ã¦è§£èª¬

---

ã“ã®ã‚ˆã†ã«ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã•ã›ã‚‹

# è¦ä»¶ã®ç¢ºèª
ã©ã‚“ãªæ‰‹æ³•ãŒã‚ã‚‹ã‹
ãƒ»å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é‡ã­ã‚‹
ãƒ»æç”»
ãƒ»æ˜ åƒã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«æ··ãœã¡ã‚ƒã†ã¨ã‹
ãƒ»é…ä¿¡ã‚’ã—ãªãŒã‚‰ãªã®ã§ã€ä½ç‡ƒè²»ã«å‹•ä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹

ã‚¢ã‚¤ãƒ†ãƒ å†ç”Ÿï¼ç”»é¢å…¨ä½“ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
//å‹•ç”»ã®ä»•æ§˜
750â€†Ã—â€†1334 60fps
å®Ÿéš›ã¯ã‚‚ã†å°‘ã—ä½ã„ãŒæ¯”è¼ƒã®ãŸã‚ã«ã“ã®ã‚¹ãƒšãƒƒã‚¯

ä¸€ç•ªæœ€åˆã«å®Ÿè£…ã—ãŸã®ã¯UIImageViewã®animateImages
ffmpeg -i M_sea30fps.mov M_sea30fps/output_%04d.png

du -h
288M    ./M_sea60fps

animateImagesãŒæ‚ªã„ï¼Ÿï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¿ã‚‹
movã‚’é€£ç•ªpngã«å¤‰æ›ã—ã¾ã™
å†ç”Ÿ
[å‹•ç”»]
ãƒ€ãƒ¡ã§ã—ãŸã€‚
animateImagesã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ¡ãƒ¢ãƒªãŒç¢ºä¿ã•ã‚Œã‚‹ï¼Ÿ
//å§‹ã¾ã‚‹ã¾ã§é…ã„
    //ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¨fps
    //ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã ã¨æ„å¤–ã¨å‹•ã...
    //ãã‚‚ãã‚‚ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å®¹é‡


//ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
æç”»å‘¨ã‚Šã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ã¯éå¸¸ã«é›£ã—ã„
Instrumentãªã©ãŒã‚ã‚‹ãŒâ€¦
ç›®ã§è¦‹ã¦ã‚„ã‚‹ã®ãŒè‰¯ã„
å®Ÿéš›ã®ç’°å¢ƒã§è¡Œã†ã®ãŒè‰¯ã„
å¤ã„ç«¯æœ«ã€å¤ã„OSã§ã‚„ã‚ã†
ä»Šå›ã¯5s
æœ€åˆã¯ã“ã†ã—ã¦ã„ãŸ
ã“ã†ã„ã†å®Ÿè£…ã®ã‚¢ãƒ—ãƒªã‚‚ã‚ã‚‹ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹

æ¬¡ã«æ¯ãƒ•ãƒ¬ãƒ¼ãƒ imageã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ã
ã“ã‚Œã¯ã©ã†ã‹ãª

ã“ã“ã¾ã§ã§äºŒã¤ã®å•é¡Œ
ãƒ»å®¹é‡ã®å•é¡Œ
ãƒ»æç”»ã®å•é¡Œ

# å®¹é‡ã®å•é¡Œ
åœ§ç¸®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ç”»åƒã«æœ€é©ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ=å‹•ç”»
å‹•ç”»ã‹ã‚‰æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒã‚’å–ã‚Šå‡ºã›ã°ã€ã‚µã‚¤ã‚ºã¯è»½ã„ã¾ã¾ãƒãƒ³ãƒ‰ãƒ«ã§ãã‚‹
GIF/APNG/WEBP/MP4/MOV
é€éã§ãã‚‹ã‹ã€ä»•çµ„ã¿ã€å…¬å¼ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã€ãƒ‡ã‚³ãƒ¼ãƒ‰è² è·ã€å®¹é‡ã€è¡¨ç¾åŠ›

- PNG/JPG
ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ

- GIF
https://github.com/kirualex/SwiftyGif
GIFã‚’1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«UIImageã«å¤‰æ›ã—ã¦ã€ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§UIImageView.imageã‚’å·®ã—æ›¿ãˆã¦ã„ã‚‹
ä¸€èˆ¬çš„ãªéå¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å¯¾å¿œã®ä»•æ–¹
æ™®é€šã¯UIImageViewã‚’ä½¿ã†ã®ã§ä½¿ã„å‹æ‰‹ãŒè‰¯ã„

- APNG
https://github.com/onevcat/APNGKit
libpng
APNGImageView: UIView
ä¸€åº¦UIImageã«å¤‰æ›ã—ã¦ã‹ã‚‰CGImageã‚’layer.contentsã«è¨­å®š
ã“ã‚Œã¯UIImageViewã¨åŒã˜ä»•çµ„ã¿

- WEBP
libWEBP

- MP4
h264
é€éæƒ…å ±æŒã¦ãªã„
ãƒ‡ãƒ•ã‚©ã§å¯¾å¿œ

- MOV
é€éæƒ…å ±ãŒæŒã¦ã‚‹

å¯¾å¿œã—ã¦ã„ã‚‹ã‚‚ã®ã‚‚å¯¾å¿œã—ã¦ã„ãªã„ã‚‚ã®ã‚‚åŸºæœ¬ã¯åŒã˜
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰â†’ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã®è‰²æƒ…å ±â†’æç”»
ãƒ‡ã‚³ãƒ¼ãƒ‰å‡¦ç†ã¯CPUã§è¡Œã‚ã‚Œã‚‹
https://developer.apple.com/videos/play/wwdc2018/219/
https://github.com/koher/EasyImagy
å®¹é‡ã¨ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ãƒ‡ã‚³ãƒ¼ãƒ‰
drawinrectä½¿ã†ã¨æœ€é©åŒ–ã®æ©æµãŒå—ã‘ã‚‰ã‚Œãªã„

# iOSã§ã¯å†ç”Ÿã§ããªã„è©±
movãŒä¸€ç•ªè‰¯ã•ãã†ã€‚
å†ç”Ÿã—ã¦ã¿ã‚‹ã€iOSã§ã¯ã§ããªã„ã€‚

é€éå‡ºæ¥ã‚‹ã®ãŒè‰¯ã•ãã†ã ã‘ã©â€¦
ãã‚‚ãã‚‚ãƒ‡ã‚³ãƒ¼ãƒ‰ã¯æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒä½œã£ã¦ã„ã‚‹
å®¹é‡ã¨ç”»è³ªã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„ã‚‚ã®ã‚’é¸ã‚“ã§å¾Œã‹ã‚‰é€éã™ã‚Œã°ã„ã„
ã©ã†ã™ã‚Œã°é€éå‡ºæ¥ã‚‹ã®ã‹
ä»Šå›ã¯mp4ã‚’é¸ã‚“ã 
ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ€ãŒå…¬å¼æä¾›ã•ã‚Œã¦ã„ã‚‹


# é€éå‹•ç”»ã®å†ç”Ÿæ‰‹æ³•ã®ç´¹ä»‹
alpha maskã‚’è¡Œã† CIFilter
äºŒã¤ã®mp4ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãªãŒã‚‰ãƒã‚¹ã‚¯
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§FilterãŒã‚ã‚‹

UIImageView.imageã¸æç”»

MP4 -> SampleBuffer -> CIImage -> CIFilter -> UIImage -> æç”»ï¼ˆUIImageViewï¼‰
é‡ã„
ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå¤§ãã„
CIImageã¯ãƒ¬ã‚·ãƒ”ã®ã‚ˆã†ãªã‚‚ã®ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ç„¡ã„
ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆã‚ã¦å‡¦ç†ãŒèµ°ã‚‹
CIFilterã®outputã‚’å¾…ã£ã¦ã‹ã‚‰ã«ãªã£ã¦ã—ã¾ã†
CIIMahgeã¯å®Ÿæ…‹ã‚’æŒãŸãªã„ã€UIImageViewã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§GPUã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã‚‹

MP4 -> SampleBuffer -> CIImage -> CIFilter -> UIImage -> æç”»ï¼ˆEAGLViewï¼‰
å¤‰ã‚ã‚‰ãªã„ï¼Ÿ
ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¨ã¯
UIImageViewã¯ååˆ†ã«é«˜é€Ÿã€OpenGLESã‚’ç›´æ¥ä½¿ã†æ„å‘³ã¯ï¼Ÿ
ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ä½¿ã†ã“ã¨ã«æ„å‘³ãŒã‚ã‚‹

CIFilterã¯outputImageã‚’å—ã‘å–ã£ã¦ã€UIImageViewã¸æ¸¡ã™
GPU->CPU->GPU
ãƒ¡ãƒ¢ãƒªãŒå…±å­˜ã—ã¦ã„ã‚‹ã‹ã‚‰è‰¯ã„ï¼ŸOpenGLESã¯å…±å­˜ã—ã¦ã„ãªã„ã€‚
ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãªã‚‰GPUã‹ã‚‰å¸°ã£ã¦ã“ãªã„

MP4 -> SampleBuffer -> CIImage -> ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§æç”»ï¼ˆEAGLViewï¼‰
æ—©ããªã£ãŸï¼ã“ã‚Œã§è‰¯ã„ã˜ã‚ƒã‚“ï¼
CIFilterä½¿ã†ãªã‚‰ãƒ¡ã‚¿ãƒ«éå¯¾å¿œæ©Ÿç¨®ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚ç¢ºèªã—ã¦ãŠãã¹ã
Kitsunebi

OpenGLES deplicated!!

MP4 -> SampleBuffer -> CIImage -> ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§æç”»ï¼ˆMTLViewï¼‰
OpenGLESã®ã‚·ã‚§ãƒ¼ãƒ€ã‹ã‚‰æ›¸ãç›´ã™
æ—©ããªã£ãŸã€å¤§ãã„ãƒ†ã‚¯ã‚¹ãƒãƒ£ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå°‘ãªã„ã‚‰ã—ã„
Kitsunebi_Metal

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ“ãƒ«ãƒ‰å‡ºæ¥ãªã„ã®ã§æ³¨æ„
å¯¾å¿œOSã«ã‚ˆã£ã¦ã¯è¾›ã„

ã“ã‚Œã¯ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’ä½¿ã£ãŸMetalã®è‰¯ã„ã‚µãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„

# ã¾ã åŠ¹ç‡åŒ–ã§ãã‚‹ç®‡æ‰€ã¯ã‚ã‚Šã¾ã™
AVAssetReader -> ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å®Ÿè£…ã—ã¦ã¿ã‚ˆã†
ã‚ªãƒ¬ã‚ªãƒ¬AVPlayer
ä¿ºã‚³ãƒ³ã€æŠ€è¡“æ›¸å±•ã§ç™ºè¡¨

---
ã‚ã‚‚

DeNAã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚¢ãƒ—ãƒªPocochaã§å®Ÿè£…ã—ãŸç”»é¢å…¨ä½“ã«å†ç”Ÿã•ã‚Œã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…ã®è©±ã‚’ã—ã¾ã™ã€‚
iOSã§ã¯å†ç”Ÿå‡ºæ¥ãªã„é€éå‹•ç”»ã®å†ç”Ÿã‚’è¡Œã†å®Ÿè£…ã‚„ã€ãã‚Œã‚‰ã®å®Ÿè£…ã®ä¸­ã§åˆ©ç”¨ã—ãŸå·¨å¤§ãªã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç”»åƒç¾¤ã®å†ç”Ÿã«æœ€é©ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’APNG/WEBPãªã©ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚„UIImageView/OpenGLES/Metalãªã©ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã‹ã‚‰èª­ã¿è§£ãã¾ã™ã€‚

70æšå‰å¾Œã«ã—ãŸã„


CPU/GPUã®ãƒ¡ãƒ¢ãƒªã¯åŒã˜å ´æ‰€ã«ã‚ã‚‹ãŒã€OpenGLESã§ã¯å…±æœ‰ã•ã‚Œã¦ã„ãªã„
http://dsas.blog.klab.org/archives/52168462.html

https://developer.apple.com/documentation/metal/fundamental_lessons/cpu_and_gpu_synchronization

60fpsã®å¤§ãã‚ã®ã‚„ã¤ç”¨æ„å‡ºæ¥ã‚‹ã‹

Metalãƒ•ã‚¡ãƒŸãƒªãƒ¼

mov -> mp4 alpha
ffmpeg -i sample.mov -vf alphaextract,format=yuv420p output.mov

mov -> é€£ç•ªpng
OpenGLã‚ˆã‚Šã‚‚Metalã®ãŒç°¡å˜

PyCoreImage
CoreImage Kernel langã¯deplicated
